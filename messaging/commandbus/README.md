# Command Bus - å‘½ä»¤æ€»çº¿

## çŠ¶æ€

ğŸš§ **è®¡åˆ’ä¸­ / Planned**

## æ¦‚è¿°

å‘½ä»¤æ€»çº¿ï¼ˆCommand Busï¼‰æ˜¯CQRSæ¨¡å¼çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºå¤„ç†ç³»ç»Ÿä¸­çš„å‘½ä»¤ï¼ˆCommandï¼‰ã€‚

## è®¾è®¡ç›®æ ‡

å‘½ä»¤æ€»çº¿å°†æä¾›ï¼š

1. **å‘½ä»¤åˆ†å‘** - å°†å‘½ä»¤è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å™¨
2. **äº‹åŠ¡ç®¡ç†** - ç¡®ä¿å‘½ä»¤æ‰§è¡Œçš„åŸå­æ€§
3. **ä¸­é—´ä»¶æ”¯æŒ** - éªŒè¯ã€æ—¥å¿—ã€äº‹åŠ¡ã€é‡è¯•ç­‰
4. **é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

## æ¶æ„è®¾è®¡

```
commandbus/
â”œâ”€â”€ commandbus.go      # å‘½ä»¤æ€»çº¿æ ¸å¿ƒå®ç°
â”œâ”€â”€ handler.go         # å‘½ä»¤å¤„ç†å™¨æ¥å£
â”œâ”€â”€ middleware.go      # ä¸­é—´ä»¶å®šä¹‰
â””â”€â”€ commandbus_test.go # å•å…ƒæµ‹è¯•
```

## ä¸EventBusçš„åŒºåˆ«

| ç‰¹æ€§ | Command Bus | Event Bus |
|------|-------------|-----------|
| ç”¨é€” | æ‰§è¡Œæ“ä½œï¼ˆå†™ï¼‰ | é€šçŸ¥äº‹ä»¶ï¼ˆè¯»ï¼‰ |
| å¤„ç†å™¨ | å•ä¸ª | å¤šä¸ª |
| è¿”å›å€¼ | æœ‰è¿”å›ç»“æœ | æ— è¿”å›å€¼ |
| äº‹åŠ¡ | éœ€è¦äº‹åŠ¡æ”¯æŒ | é€šå¸¸æ— äº‹åŠ¡ |
| æ—¶åº | åŒæ­¥ä¼˜å…ˆ | å¼‚æ­¥ä¼˜å…ˆ |

## ä½¿ç”¨åœºæ™¯

```go
// å®šä¹‰å‘½ä»¤
type CreateOrderCommand struct {
    UserID    int64
    ProductID int64
    Quantity  int
}

// å®šä¹‰å¤„ç†å™¨
type CreateOrderHandler struct {
    repo repository.OrderRepository
}

func (h *CreateOrderHandler) Handle(ctx context.Context, cmd *CreateOrderCommand) error {
    // å¤„ç†å‘½ä»¤é€»è¾‘
    return h.repo.Create(ctx, order)
}

// ä½¿ç”¨å‘½ä»¤æ€»çº¿
commandBus := commandbus.New()
commandBus.Register(&CreateOrderCommand{}, &CreateOrderHandler{})
err := commandBus.Dispatch(ctx, &CreateOrderCommand{...})
```

## å®ç°è®¡åˆ’

### Phase 1 - æ ¸å¿ƒåŠŸèƒ½
- [ ] å‘½ä»¤æ€»çº¿æ¥å£å®šä¹‰
- [ ] å‘½ä»¤å¤„ç†å™¨æ³¨å†Œ
- [ ] å‘½ä»¤åˆ†å‘æœºåˆ¶
- [ ] åŸºæœ¬é”™è¯¯å¤„ç†

### Phase 2 - ä¸­é—´ä»¶
- [ ] éªŒè¯ä¸­é—´ä»¶
- [ ] æ—¥å¿—ä¸­é—´ä»¶
- [ ] äº‹åŠ¡ä¸­é—´ä»¶
- [ ] é‡è¯•ä¸­é—´ä»¶

### Phase 3 - é«˜çº§ç‰¹æ€§
- [ ] å‘½ä»¤é˜Ÿåˆ—æ”¯æŒ
- [ ] å¼‚æ­¥å‘½ä»¤å¤„ç†
- [ ] å‘½ä»¤å®¡è®¡
- [ ] æ€§èƒ½ç›‘æ§

## ä¸ºä»€ä¹ˆæš‚æœªå®ç°ï¼Ÿ

1. **EventBusä¼˜å…ˆ** - é¡¹ç›®ä¼˜å…ˆå®ç°äº†äº‹ä»¶æ€»çº¿ï¼Œå‘½ä»¤æ€»çº¿å¯ä»¥åŸºäºç›¸åŒçš„messaging/coreåŸºç¡€æ„å»º
2. **éœ€æ±‚é©±åŠ¨** - å½“å‰ä¸šåŠ¡åœºæ™¯ä¸‹EventBuså·²æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚
3. **æ¶æ„å®Œæ•´æ€§** - ä¿ç•™ç›®å½•ç»“æ„ä»¥ä¿æŒCQRSæ¶æ„çš„å®Œæ•´æ€§

## å‚è€ƒèµ„æº

- [CQRS Pattern](https://martinfowler.com/bliki/CQRS.html)
- [Command Pattern](https://refactoring.guru/design-patterns/command)
- messaging/core/ - å¯å¤ç”¨çš„æ¶ˆæ¯åŸºç¡€è®¾æ–½
- messaging/eventbus/ - äº‹ä»¶æ€»çº¿å®ç°å‚è€ƒ

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®CommandBusçš„å®ç°ï¼å®ç°æ—¶è¯·å‚è€ƒï¼š
- messaging/core/ çš„æ¥å£è®¾è®¡
- messaging/eventbus/ çš„å®ç°æ¨¡å¼
- ç¡®ä¿ä¸ç°æœ‰æ¶æ„ä¸€è‡´
